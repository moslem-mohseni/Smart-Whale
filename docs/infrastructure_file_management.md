# ูุณุชูุฏุงุช ูุงฺูู File Management

## ๐ฏ ูุฏู ูุงฺูู

๐ **ูุณุฑ ูุงฺูู:** `infrastructure/file_management/`

ูุงฺูู `File Management` ุจุฑุง **ูุฏุฑุชุ ุฐุฎุฑูโุณุงุฒ ู ูพุฑุฏุงุฒุด ูุงูโูุง** ุฏุฑ ุณุณุชู ุทุฑุงุญ ุดุฏู ุงุณุช. ุงู ูุงฺูู ุงุฒ **MinIO** ุจูโุนููุงู ุณุณุชู ุฐุฎุฑูโุณุงุฒ ุงุจุฑ ุงุณุชูุงุฏู ูโฺฉูุฏ ู ูุงุจูุชโูุง ุฒุฑ ุฑุง ุงุฑุงุฆู ูโุฏูุฏ:

- **ูุฏุฑุช ูุงูโูุง ุญุฌู** ุจุง ูพุดุชุจุงู ุงุฒ **Multipart Upload**
- **ุชุดุฎุต ู ุฌููฺฏุฑ ุงุฒ ุฐุฎุฑูโุณุงุฒ ูุงูโูุง ุชฺฉุฑุงุฑ (Deduplication)**
- **ูุฏุฑุช ุฏุณุชุฑุณ ฺฉุงุฑุจุฑุงู** ุจุง ุงุณุชูุงุฏู ุงุฒ **RBAC ู JWT**
- **ุฑูุฒูฺฏุงุฑุ ูุดุฑุฏูโุณุงุฒ ู ุงููโุณุงุฒ ูุงูโูุง**
- **ฺฉุดูฺฏ ู ุจูููโุณุงุฒ ุจุฑุง ุงูุฒุงุด ุณุฑุนุช ุฏุณุชุฑุณ**
- **ฺฉูพุงุฑฺูโุณุงุฒ ุจุง ุณุณุชูโูุง Kafka ู Redis ุจุฑุง ูพุฑุฏุงุฒุดโูุง ูุงููฺฏุงู**
- **ุณุณุชู ูุงูุชูุฑูฺฏ ู ุซุจุช ูุชุฑฺฉโูุง ุนููฺฉุฑุฏ**

---

## ๐ **ุณุงุฎุชุงุฑ ุฏุงุฑฺฉุชูุฑ ูุงฺูู**
```
file_management/
โโโ __init__.py                    # ููุฏุงุฑุฏู ุงููู ูุงฺูู
โ
โโโ adapters/                       # ูุฏุฑุช ุงุฑุชุจุงุท ุจุง MinIO ู ุฒุฑุณุงุฎุชโูุง
โ   โโโ minio_adapter.py            # ุขุฏุงูพุชูุฑ ุงุฑุชุจุงุท ุจุง MinIO
โ   โโโ retry_mechanism.py          # ูุฏุฑุช Retry ุจุฑุง ุนููุงุช ูุงูููู
โ   โโโ circuit_breaker.py          # ูุฏุฑุช Circuit Breaker ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุดุงุฑ ุจุฑ ุณุณุชู
โ   โโโ connection_pool.py          # ูุฏุฑุช ุงุชุตุงูโูุง MinIO
โ
โโโ cache/                          # ุณุณุชู ฺฉุด ุจุฑุง ุงูุฒุงุด ุณุฑุนุช ูพุฑุฏุงุฒุด
โ   โโโ cache_manager.py            # ูุฏุฑุช ฺฉุด ูุชุงุฏุชุง ูุงูโูุง
โ   โโโ hash_cache.py               # ุฐุฎุฑู ูุดโูุง ูุงูโูุง ุจุฑุง Deduplication
โ
โโโ config/                         # ุชูุธูุงุช ู ูพฺฉุฑุจูุฏ
โ   โโโ settings.py                 # ุชูุธูุงุช ฺฉู ุณุณุชู
โ   โโโ bucket_config.py            # ุชูุธูุงุช ูุฑุจูุท ุจู ุจุงฺฉุชโูุง MinIO
โ
โโโ domain/                         # ูุฏูโูุง ุฏุงุฏูโุง ู ุงุดุง ููุฏุงุฑ
โ   โโโ models.py                   # ูุฏูโูุง ูุฑุชุจุท ุจุง ูุงู
โ   โโโ value_objects.py            # ุงุดุง ููุฏุงุฑ ู ุงููุงุน ุฏุงุฏูโุง
โ   โโโ file_metadata.py            # ูุฏุฑุช ูุชุงุฏุชุง ูุงูโูุง
โ   โโโ hash_service.py             # ูุฏุฑุช ู ูุญุงุณุจู ูุด ูุงูโูุง
โ
โโโ monitoring/                     # ุณุณุชู ูุงูุชูุฑูฺฏ ู ูุชุฑฺฉโูุง ุนููฺฉุฑุฏ
โ   โโโ metrics.py                  # ุฌูุนโุขูุฑ ูุชุฑฺฉโูุง ูุฑุจูุท ุจู ูุฏุฑุช ูุงู
โ   โโโ health_check.py             # ุจุฑุฑุณ ุณูุงูุช ุณุฑูุณ ู ุงุชุตุงู ุจู MinIO
โ
โโโ security/                        # ูุฏุฑุช ุงููุช ู ฺฉูุชุฑู ุฏุณุชุฑุณ
โ   โโโ access_control.py           # ฺฉูุชุฑู ุฏุณุชุฑุณ ุจู ูุงูโูุง ุจุฑ ุงุณุงุณ JWT
โ   โโโ file_validator.py           # ุจุฑุฑุณ ููุนุ ุงูุฏุงุฒู ู ุงููุช ูุงูโูุง
โ   โโโ sanitizer.py                # ูพุงฺฉุณุงุฒ ูุงู ู ูุญุชูุง ูุงู ุงุฒ ุฏุงุฏูโูุง ูุฎุฑุจ
โ   โโโ encryption.py               # ุฑูุฒูฺฏุงุฑ ูุงูโูุง
โ
โโโ service/                         # ูพุงุฏูโุณุงุฒ ุณุฑูุณโูุง ุงุตู ูุฏุฑุช ูุงู
โ   โโโ file_service.py             # ุณุฑูุณ ุขูพููุฏุ ุฏุงูููุฏ ู ุญุฐู ูุงูโูุง
โ   โโโ search_service.py           # ุณุฑูุณ ุฌุณุชุฌู ูุงูโูุง
โ   โโโ compression.py              # ูุดุฑุฏูโุณุงุฒ ูุงูโูุง
โ
โโโ storage/                         # ูุฏุฑุช ุฐุฎุฑูโุณุงุฒ ู ฺุฑุฎู ุญุงุช ูุงูโูุง
โ   โโโ file_store.py               # ุณุณุชู ุฐุฎุฑูโุณุงุฒ ูุงูโูุง
โ   โโโ deduplication.py            # ูุฏุฑุช ู ุชุดุฎุต ูุงูโูุง ุชฺฉุฑุงุฑ
โ   โโโ lifecycle.py                # ุณุณุชู ูุฏุฑุช ฺุฑุฎู ุญุงุช ูุงูโูุง
```

---

## โ **ูฺฺฏโูุง ฺฉูุฏ ูุงฺูู**
โ **ุฐุฎุฑูโุณุงุฒ ู ุจุงุฒุงุจ ุณุฑุน ูุงูโูุง** โ ุงุณุชูุงุฏู ุงุฒ **MinIO** ุจุฑุง ููุงุณโูพุฐุฑ ุจูุชุฑ  
โ **ูุฏุฑุช ูุงูโูุง ุชฺฉุฑุงุฑ** โ ุชุดุฎุต ูุงูโูุง ูุดุงุจู ุจุฑ ุงุณุงุณ **ูุดโฺฏุฐุงุฑ**  
โ **ุงููุช ู ฺฉูุชุฑู ุฏุณุชุฑุณ** โ ุงุญุฑุงุฒ ููุช **JWT** ู **ุฑูุฒูฺฏุงุฑ ูุงูโูุง**  
โ **ุจูููโุณุงุฒ ุนููฺฉุฑุฏ** โ ฺฉุดูฺฏ ุจุง **Redis**ุ ูุดุฑุฏูโุณุงุฒ ู ูุฏุฑุช ฺุฑุฎู ุญุงุช  
โ **ูุฏุฑุช ุฏุณุชุฑุณ ุณุทุญ ุจุงูุง** โ **RBAC** ุจุฑุง ฺฉุงุฑุจุฑุงู ู **Audit Logging** ุจุฑุง ุซุจุช ุนููุงุช  

---



# ๐ ูุณุชูุฏุงุช ูู ูุงฺูู File Management

## ๐ ูุนุฑู ุจุฎุดโูุง ูุงฺูู
ุงู ุจุฎุด ุดุงูู ุชูุถุญุงุช ุฏูู ุฏุฑุจุงุฑู **ูุฑ ูุงฺููุ ฺฉูุงุณ ู ูุชุฏ** ุฏุฑ ุณุณุชู ูุฏุฑุช ูุงูโูุง ุงุณุช.

---

## ๐ **1. ุจุฎุด `adapters/` (ุงุชุตุงู ุจู MinIO ู ุฒุฑุณุงุฎุช)**
### ๐น `minio_adapter.py`
- **MinIOAdapter** โ ูุฏุฑุช ุงุฑุชุจุงุท ุจุง MinIO
  - `upload_file(file_name, data)` โ ุขูพููุฏ ูุงู ุจู MinIO
  - `download_file(file_name)` โ ุฏุฑุงูุช ูุงู ุงุฒ MinIO
  - `delete_file(file_name)` โ ุญุฐู ูุงู ุงุฒ MinIO

### ๐น `retry_mechanism.py`
- **RetryHandler** โ ุงุฌุฑุง ูุฌุฏุฏ ุนููุงุช ุฏุฑ ุตูุฑุช ุจุฑูุฒ ุฎุทุง
  - `execute_with_retry(operation, retries=3)` โ ุงุฌุฑุง ุชุงุจุน ุจุง ูุงุจูุช Retry

### ๐น `circuit_breaker.py`
- **CircuitBreaker** โ ุฌููฺฏุฑ ุงุฒ ุงุฑุณุงู ุฏุฑุฎูุงุณุชโูุง ูฺฉุฑุฑ ุฏุฑ ุตูุฑุช ุจุฑูุฒ ุฎุทุง
  - `call(operation)` โ ุงุฌุฑุง ุนููุงุช ุจุง Circuit Breaker

---

## โก **2. ุจุฎุด `cache/` (ูุฏุฑุช ฺฉุด ู ุงูุฒุงุด ุณุฑุนุช)**
### ๐น `cache_manager.py`
- **CacheManager** โ ูุฏุฑุช ฺฉุด ุจุง Redis
  - `set(key, value, ttl=3600)` โ ุฐุฎุฑู ููุฏุงุฑ ุฏุฑ ฺฉุด
  - `get(key)` โ ุฏุฑุงูุช ููุฏุงุฑ ุงุฒ ฺฉุด
  - `delete(key)` โ ุญุฐู ููุฏุงุฑ ุงุฒ ฺฉุด

### ๐น `hash_cache.py`
- **HashCache** โ ูุฏุฑุช ูุด ูุงูโูุง ุฏุฑ ฺฉุด ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฐุฎุฑู ูุงูโูุง ุชฺฉุฑุงุฑ
  - `store_file_hash(file_name, file_hash)` โ ุฐุฎุฑู ูุด ูุงู ุฏุฑ ฺฉุด
  - `get_file_hash(file_name)` โ ุฏุฑุงูุช ูุด ูุงู ุงุฒ ฺฉุด

---

## โ๏ธ **3. ุจุฎุด `config/` (ุชูุธูุงุช ู ูพฺฉุฑุจูุฏ)**
### ๐น `settings.py`
- ูุฏุฑุช ุชูุธูุงุช **MinIOุ Kafkaุ Redis ู ูุญุฏูุฏุชโูุง ูุงูโูุง**

### ๐น `bucket_config.py`
- ูุฏุฑุช ู ูพฺฉุฑุจูุฏ **ุจุงฺฉุชโูุง MinIO**

---

## ๐ **4. ุจุฎุด `domain/` (ูุฏูโูุง ุฏุงุฏูโุง ู ุงุดุง ููุฏุงุฑ)**
### ๐น `models.py`
- **FileModel** โ ูุฏู ุฏุงุฏูโุง ุงุตู ูุงู
  - ูฺฺฏโูุง: `id`ุ `name`ุ `size`ุ `type`ุ `created_at`

### ๐น `file_metadata.py`
- **FileMetadata** โ ูุชุงุฏุชุง ูุงูโูุง ุดุงูู ููุนุ ุงูุฏุงุฒู ู ุฒูุงู ุงุฌุงุฏ

### ๐น `hash_service.py`
- **HashService** โ ูุญุงุณุจู ูุด ูุงู ุจุฑุง Deduplication
  - `calculate_hash(file_data)` โ ูุญุงุณุจู `SHA-256` ุงุฒ ุฏุงุฏูโูุง ูุงู

---

## ๐ **5. ุจุฎุด `service/` (ูุฏุฑุช ูุงูโูุง ู ูพุฑุฏุงุฒุด)**
### ๐น `file_service.py`
- **FileService** โ ูุฏุฑุช ูุงูโูุง (ุขูพููุฏุ ุฏุงูููุฏุ ุญุฐู)
  - `upload_file(file_data)` โ ุฐุฎุฑู ูุงู ุจุง ุจุฑุฑุณ ูุด ู ฺฉูุชุฑู ุฏุณุชุฑุณ
  - `download_file(file_id)` โ ุฏุฑุงูุช ูุงู ุจุง ุจุฑุฑุณ ูุฌูุฒ ุฏุณุชุฑุณ
  - `delete_file(file_id)` โ ุญุฐู ูุงู ุจุง ุซุจุช ฺฏุฒุงุฑุด ูุงฺฏ

### ๐น `search_service.py`
- **SearchService** โ ุฌุณุชุฌู ูุงูโูุง
  - `find_by_name(file_name)` โ ุฌุณุชุฌู ูุงู ุจุง ูุงู
  - `find_by_hash(file_hash)` โ ุฌุณุชุฌู ูุงู ุจุฑ ุงุณุงุณ ูุด

### ๐น `compression.py`
- **CompressionService** โ ูุดุฑุฏูโุณุงุฒ ู ุงุณุชุฎุฑุงุฌ ูุงูโูุง
  - `compress_file(file_data)` โ ูุดุฑุฏูโุณุงุฒ ุฏุงุฏูโูุง ูุงู
  - `extract_file(compressed_data)` โ ุงุณุชุฎุฑุงุฌ ูุงู ูุดุฑุฏูโุดุฏู

---

## ๐ **6. ุจุฎุด `security/` (ุงููุชุ ฺฉูุชุฑู ุฏุณุชุฑุณ ู ุฑูุฒูฺฏุงุฑ)**
### ๐น `access_control.py`
- **AccessControl** โ ูุฏุฑุช ููุดโูุง ฺฉุงุฑุจุฑุงู ุจุง JWT

### ๐น `file_validator.py`
- **FileValidator** โ ุจุฑุฑุณ ููุน ู ุงูุฏุงุฒู ูุงู ูุจู ุงุฒ ุฐุฎุฑู

### ๐น `encryption.py`
- **EncryptionService** โ ุฑูุฒูฺฏุงุฑ ู ุฑูุฒฺฏุดุง ูุงูโูุง

---

## ๐ **7. ุจุฎุด `storage/` (ุฐุฎุฑูโุณุงุฒ ู ูุฏุฑุช ุฏุงุฏูโูุง)**
### ๐น `file_store.py`
- **FileStore** โ ูุฏุฑุช ุณุงุฎุชุงุฑ ุฏุงุฑฺฉุชูุฑ ู ุฐุฎุฑูโุณุงุฒ ูุงูโูุง

### ๐น `deduplication.py`
- **DeduplicationService** โ ุจุฑุฑุณ ู ุญุฐู ูุงูโูุง ุชฺฉุฑุงุฑ

### ๐น `lifecycle.py`
- **LifecycleManager** โ ูุฏุฑุช ฺุฑุฎู ุญุงุช ู ุญุฐู ูุงูโูุง ูุฏู

---



# ๐ ููููู ุงุณุชูุงุฏู ุงุฒ ูุงฺูู File Management

## ๐ ุฑุงูููุง ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณโูุง ู ูุชุฏูุง ุงุตู

### ๐ **ฑ. ุฑุงูโุงูุฏุงุฒ ูุงฺูู ู ุชูุธูุงุช ุงููู**
ุงุจุชุฏุง ุจุงุฏ ุชูุธูุงุช ูุญุท ุฑุง ุจุงุฑฺฏุฐุงุฑ ฺฉูู:

```python
from infrastructure.file_management.config.settings import FileManagementSettings

# ุจุงุฑฺฏุฐุงุฑ ุชูุธูุงุช
settings = FileManagementSettings()
print(settings.MINIO_ENDPOINT)
```

---

### ๐ **ฒ. ูุฏุฑุช ูุงูโูุง ุจุง `FileService`**

#### ๐ **ุขูพููุฏ ูุงู**
```python
from infrastructure.file_management.service.file_service import FileService

file_service = FileService()

with open("sample.txt", "rb") as file:
    file_data = file.read()

file_id = file_service.upload_file(file_data)
print(f"File uploaded successfully with ID: {file_id}")
```

#### ๐ **ุฏุงูููุฏ ูุงู**
```python
downloaded_file = file_service.download_file(file_id)
with open("downloaded_sample.txt", "wb") as file:
    file.write(downloaded_file)

print("File downloaded successfully!")
```

#### ๐ **ุญุฐู ูุงู**
```python
file_service.delete_file(file_id)
print("File deleted successfully!")
```

---

### ๐ **ณ. ุฌุณุชุฌู ูุงูโูุง ุจุง `SearchService`**

#### ๐ **ุฌุณุชุฌู ุจุฑ ุงุณุงุณ ูุงู ูุงู**
```python
from infrastructure.file_management.service.search_service import SearchService

search_service = SearchService()
results = search_service.find_by_name("sample.txt")

print("Search results:", results)
```

#### ๐ **ุฌุณุชุฌู ุจุฑ ุงุณุงุณ ูุด ูุงู**
```python
hash_results = search_service.find_by_hash("e3b0c44298fc1c149afbf4c8996fb924")
print("Hash search results:", hash_results)
```

---

### ๐ **ด. ุฑูุฒูฺฏุงุฑ ู ุงููุช ูุงูโูุง ุจุง `EncryptionService`**

#### ๐ **ุฑูุฒูฺฏุงุฑ ูุงู**
```python
from infrastructure.file_management.security.encryption import EncryptionService

encryption_service = EncryptionService()
encrypted_data = encryption_service.encrypt(file_data)

print("Encrypted Data:", encrypted_data)
```

#### ๐ **ุฑูุฒฺฏุดุง ูุงู**
```python
decrypted_data = encryption_service.decrypt(encrypted_data)

print("Decrypted Data:", decrypted_data.decode("utf-8"))
```

---

### โก **ต. ูุฏุฑุช ฺฉุด ู ุฌููฺฏุฑ ุงุฒ ุขูพููุฏ ูุงูโูุง ุชฺฉุฑุงุฑ**

#### ๐ **ุจุฑุฑุณ ูุด ูุงู ู ุฌููฺฏุฑ ุงุฒ ุฐุฎุฑูโุณุงุฒ ุชฺฉุฑุงุฑ**
```python
from infrastructure.file_management.cache.hash_cache import HashCache

hash_cache = HashCache()
file_hash = "e3b0c44298fc1c149afbf4c8996fb924"  # ููููู ูุด

if hash_cache.get_file_hash("sample.txt"):
    print("File already exists in cache!")
else:
    hash_cache.store_file_hash("sample.txt", file_hash)
    print("File hash stored successfully!")
```

---

### ๐ฏ **ถ. ูุฏุฑุช ฺุฑุฎู ุญุงุช ู ุญุฐู ูุงูโูุง ูุฏู**

```python
from infrastructure.file_management.storage.lifecycle import LifecycleManager

lifecycle_manager = LifecycleManager()
lifecycle_manager.cleanup_old_files()

print("Old files removed successfully!")
```

---

