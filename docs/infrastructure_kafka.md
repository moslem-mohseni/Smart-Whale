# Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù…Ø§Ú˜ÙˆÙ„ Kafka

## Ù‡Ø¯Ù Ù…Ø§Ú˜ÙˆÙ„

ğŸ“‚ **Ù…Ø³ÛŒØ± Ù…Ø§Ú˜ÙˆÙ„:** `infrastructure/kafka/`

Ù…Ø§Ú˜ÙˆÙ„ `Kafka` Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ± Kafka Ø¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø§ÛŒÙ† Ù…Ø§Ú˜ÙˆÙ„ Ø´Ø§Ù…Ù„ ØªÙˆÙ„ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡ Ùˆ Ù…ØµØ±Ùâ€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù¾ÛŒØ§Ù…ØŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¶ÙˆØ¹Ø§ØªØŒ Ù…Ù‡Ø§Ø¬Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ KafkaØŒ Ùˆ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ùˆ Ù¾Ø§ÛŒØ´ Ø§Ø³Øª.

---

## **Ø³Ø§Ø®ØªØ§Ø± Ù…Ø§Ú˜ÙˆÙ„**

```
kafka/
    â”‚â”€â”€ __init__.py                # Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù…Ø§Ú˜ÙˆÙ„
    â”‚
    â”œâ”€â”€ adapters/
    â”‚   â”œâ”€â”€ __init__.py            # Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¢Ø¯Ø§Ù¾ØªÙˆØ±Ù‡Ø§
    â”‚   â”œâ”€â”€ backpressure.py       # Ù…Ø¯ÛŒØ±ÛŒØª ÙØ´Ø§Ø± Ø¨Ø§Ø± Ù…ØµØ±Ùâ€ŒÚ©Ù†Ù†Ø¯Ù‡â€ŒÙ‡Ø§
    â”‚   â”œâ”€â”€ circuit_breaker.py    # Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§ Ø¨Ø§ Ù…Ú©Ø§Ù†ÛŒØ²Ù… Circuit Breaker
    â”‚   â”œâ”€â”€ connection_pool.py    # Ù…Ø¯ÛŒØ±ÛŒØª Ø§ØªØµØ§Ù„ Ø¨Ù‡ Kafka
    â”‚   â”œâ”€â”€ consumer.py          # Ú©Ù„Ø§Ø³ Ù…ØµØ±Ùâ€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù¾ÛŒØ§Ù… Kafka
    â”‚   â”œâ”€â”€ producer.py          # Ú©Ù„Ø§Ø³ ØªÙˆÙ„ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡ Ù¾ÛŒØ§Ù… Kafka
    â”‚   â””â”€â”€ retry_mechanism.py   # Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
    â”‚
    â”œâ”€â”€ config/
    â”‚   â”œâ”€â”€ __init__.py            # Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
    â”‚   â””â”€â”€ settings.py            # ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ Kafka
    â”‚
    â”œâ”€â”€ domain/
    â”‚   â”œâ”€â”€ __init__.py            # Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù…Ø¯Ù„â€ŒÙ‡Ø§
    â”‚   â””â”€â”€ models.py              # Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Kafka
    â”‚
    â”œâ”€â”€ migrations/
    â”‚   â”œâ”€â”€ __init__.py            # Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù…Ù‡Ø§Ø¬Ø±Øªâ€ŒÙ‡Ø§
    â”‚   â””â”€â”€ v001_create_base_topics.py # Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ Kafka
    â”‚
    â”œâ”€â”€ monitoring/
    â”‚   â”œâ”€â”€ __init__.py            # Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù¾Ø§ÛŒØ´
    â”‚   â”œâ”€â”€ alerts.py              # Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Kafka
    â”‚   â”œâ”€â”€ health_check.py        # Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª Kafka
    â”‚   â””â”€â”€ metrics.py             # Ø«Ø¨Øª Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Kafka
    â”‚
    â”œâ”€â”€ scripts/
    â”‚   â”œâ”€â”€ __init__.py            # Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§
    â”‚   â”œâ”€â”€ maintenance.py         # Ø¹Ù…Ù„ÛŒØ§Øª Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Kafka
    â”‚   â””â”€â”€ topic_manager.py       # Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Kafka
    â”‚
    â””â”€â”€ service/
        â”œâ”€â”€ __init__.py            # Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
        â”œâ”€â”€ batch_processor.py     # Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
        â”œâ”€â”€ kafka_service.py       # Ø³Ø±ÙˆÛŒØ³ Ù…Ø±Ú©Ø²ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Kafka
        â”œâ”€â”€ message_cache.py       # Ú©Ø´ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
        â””â”€â”€ partition_manager.py   # Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø§Ø±ØªÛŒØ´Ù†â€ŒÙ‡Ø§
```

---

## **Ø´Ø±Ø­ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ùˆ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¢Ù†â€ŒÙ‡Ø§**

### **1ï¸âƒ£ `consumer.py` - Ù…ØµØ±Ùâ€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù¾ÛŒØ§Ù… Kafka**
ğŸ“Œ **Ù‡Ø¯Ù:** Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ø§Ø² Kafka.

**Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ Ùˆ Ù…ØªØ¯Ù‡Ø§:**

#### `MessageConsumer`
- `__init__(config: KafkaConfig)`: Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù…ØµØ±Ùâ€ŒÚ©Ù†Ù†Ø¯Ù‡
- `async consume(topic: str, group_id: str, handler: Callable[[Message], Awaitable[None]]) -> None`: Ø§Ø´ØªØ±Ø§Ú© Ø¯Ø± Ù…ÙˆØ¶ÙˆØ¹ Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
- `async stop() -> None`: ØªÙˆÙ‚Ù Ù…ØµØ±Ùâ€ŒÚ©Ù†Ù†Ø¯Ù‡

---

### **2ï¸âƒ£ `producer.py` - ØªÙˆÙ„ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡ Ù¾ÛŒØ§Ù… Kafka**
ğŸ“Œ **Ù‡Ø¯Ù:** Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø¨Ù‡ Kafka.

**Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ Ùˆ Ù…ØªØ¯Ù‡Ø§:**

#### `MessageProducer`
- `__init__(config: KafkaConfig)`: Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ØªÙˆÙ„ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡
- `async send(message: Message) -> None`: Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Kafka
- `async send_batch(messages: List[Message]) -> None`: Ø§Ø±Ø³Ø§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§

---

### **3ï¸âƒ£ `settings.py` - ØªÙ†Ø¸ÛŒÙ…Ø§Øª Kafka**
ğŸ“Œ **Ù‡Ø¯Ù:** Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Kafka.

**Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ Ùˆ Ù…ØªØ¯Ù‡Ø§:**

#### `KafkaConfig`
- `get_producer_config() -> dict`: ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªÙˆÙ„ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡
- `get_consumer_config() -> dict`: ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ØµØ±Ùâ€ŒÚ©Ù†Ù†Ø¯Ù‡
- `get_security_config() -> dict`: ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ

---

### **4ï¸âƒ£ `models.py` - Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ**
ğŸ“Œ **Ù‡Ø¯Ù:** ØªØ¹Ø±ÛŒÙ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Kafka.

**Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§:**

- `Message`: Ù…Ø¯Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Kafka Ø´Ø§Ù…Ù„ `topic`ØŒ `content`ØŒ `metadata`
- `TopicConfig`: ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÙˆØ¶ÙˆØ¹ Ø´Ø§Ù…Ù„ ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø§Ø±ØªÛŒØ´Ù†â€ŒÙ‡Ø§ Ùˆ ÙØ§Ú©ØªÙˆØ± ØªÚ©Ø±Ø§Ø±

---

### **5ï¸âƒ£ `kafka_service.py` - Ø³Ø±ÙˆÛŒØ³ Ù…Ø±Ú©Ø²ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Kafka**
ğŸ“Œ **Ù‡Ø¯Ù:** Ù†Ù‚Ø·Ù‡ Ù…Ø±Ú©Ø²ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ØªÙˆÙ„ÛŒØ¯ Ùˆ Ù…ØµØ±Ù Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§.

**Ú©Ù„Ø§Ø³:**

#### `KafkaService`
- `async send_message(message: Message) -> None`: Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Kafka
- `async send_messages_batch(messages: List[Message]) -> None`: Ø§Ø±Ø³Ø§Ù„ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
- `async subscribe(topic: str, group_id: str, handler: Callable[[Message], Awaitable[None]]) -> None`: Ø§Ø´ØªØ±Ø§Ú© Ø¯Ø± ÛŒÚ© Ù…ÙˆØ¶ÙˆØ¹
- `async stop_all() -> None`: ØªÙˆÙ‚Ù ØªÙ…Ø§Ù… Ù…ØµØ±Ùâ€ŒÚ©Ù†Ù†Ø¯Ù‡â€ŒÙ‡Ø§
- `async create_topic(topic_config: TopicConfig) -> None`: Ø§ÛŒØ¬Ø§Ø¯ ÛŒÚ© Ù…ÙˆØ¶ÙˆØ¹ Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Kafka

---

### **6ï¸âƒ£ `monitoring/` - Ù¾Ø§ÛŒØ´ Kafka**
ğŸ“Œ **Ù‡Ø¯Ù:** Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Kafka Ùˆ Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§.

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§:**
- `alerts.py`: Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Kafka
- `health_check.py`: Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø³Ù„Ø§Ù…Øª Kafka
- `metrics.py`: Ø«Ø¨Øª Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§ÛŒ Kafka

---

## **Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ø§Ú˜ÙˆÙ„ Ø¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡**

```python
from infrastructure.kafka.service.kafka_service import KafkaService
from infrastructure.kafka.config.settings import KafkaConfig
from infrastructure.kafka.domain.models import Message

config = KafkaConfig()
kafka_service = KafkaService(config)

message = Message(topic="test_topic", content="Hello Kafka!")
await kafka_service.send_message(message)
```

